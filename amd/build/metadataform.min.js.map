{"version":3,"file":"metadataform.min.js","sources":["../src/metadataform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for configuring metadata\n * @module     mod_sharedresource/view\n * @package    blocks\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:true\ndefine(['jquery', 'core/log'], function ($, log) {\n\n    var namespace;\n\n    return {\n        init: function(args) {\n\n            namespace = args;\n\n            $('#id-system-mtd-selectall-write').bind('click', this.selectall_system_write);\n            $('#id-indexer-mtd-selectall-write').bind('click', this.selectall_indexer_write);\n            $('#id-author-mtd-selectall-write').bind('click', this.selectall_author_write);\n\n            $('#id-system-mtd-selectall-read').bind('click', this.selectall_system_read);\n            $('#id-indexer-mtd-selectall-read').bind('click', this.selectall_indexer_read);\n            $('#id-author-mtd-selectall-read').bind('click', this.selectall_author_read);\n\n            $('#id-mandatory-mtd-selectall').bind('click', this.selectall_mandatory);\n\n            $('#id-system-mtd-selectnone-write').bind('click', this.selectnone_system_write);\n            $('#id-indexer-mtd-selectnone-write').bind('click', this.selectnone_indexer_write);\n            $('#id-author-mtd-selectnone-write').bind('click', this.selectnone_author_write);\n\n            $('#id-system-mtd-selectnone-read').bind('click', this.selectnone_system_read);\n            $('#id-indexer-mtd-selectnone-read').bind('click', this.selectnone_indexer_read);\n            $('#id-author-mtd-selectnone-read').bind('click', this.selectnone_author_read);\n\n            $('#id-mandatory-mtd-selectnone').bind('click', this.selectnone_mandatory);\n\n            $('.mtd-check').bind('change', this.toggle_childs);\n            $('.mtd-parent').bind('init', this.init_parent);\n            $('.mtd-parent').trigger('init');\n            $('.mtd-widget').bind('rowchange', this.widget_check);\n\n            log.debug('AMD Mod sharedresource metadata configuration form initialized');\n        },\n\n\n        selectall_system_write: function (){\n            $('.' + namespace + '-system-write').prop('checked', true);\n            $('.' + namespace + '-system-read').prop('checked', true);\n            $('.' + namespace + '-system-read').prop('disabled', true);\n        },\n\n        selectall_system_read: function (){\n            $('.' + namespace + '-system-read').prop('checked', true);\n        },\n\n        selectall_indexer_write: function (){\n            $('.' + namespace + '-indexer-write').prop('checked', true);\n            $('.' + namespace + '-indexer-read').prop('checked', true);\n            $('.' + namespace + '-indexer-read').prop('disabled', true);\n        },\n\n        selectall_indexer_read: function (){\n            $('.' + namespace + '-indexer-read').prop('checked', true);\n        },\n\n        selectall_author_write: function (){\n            $('.' + namespace + '-author-write').prop('checked', true);\n            $('.' + namespace + '-author-read').prop('checked', true);\n            $('.' + namespace + '-author-read').prop('disabled', true);\n        },\n\n        selectall_author_read: function (){\n            $('.' + namespace + '-author-read').prop('checked', true);\n        },\n\n        selectall_mandatory: function (){\n            $('.' + namespace + '-mandatory').prop('checked', true);\n        },\n\n        selectnone_system_write: function (){\n            $('.' + namespace + '-system-write').prop('checked', false);\n            $('.' + namespace + '-system-read').prop('disabled', false);\n        },\n\n        selectnone_system_read: function (){\n            $('.' + namespace + '-system-read').prop('checked', false);\n        },\n\n        selectnone_indexer_write: function (){\n            $('.' + namespace + '-indexer-write').prop('checked', false);\n            $('.' + namespace + '-indexer-read').prop('disabled', false);\n        },\n\n        selectnone_indexer_read: function (){\n            $('.' + namespace + '-indexer-read').prop('checked', false);\n        },\n\n        selectnone_author_write: function (){\n            $('.' + namespace + '-author-write').prop('checked', false);\n            $('.' + namespace + '-author-read').prop('disabled', false);\n        },\n\n        selectnone_author_read: function (){\n            $('.' + namespace + '-author-read').prop('checked', false);\n        },\n\n        selectnone_mandatory: function (){\n            $('.' + namespace + '-mandatory').prop('checked', false);\n        },\n\n        init_parent: function () {\n\n            var that = $(this);\n\n            var regexp = /([^-]*)-([^-]*)-([^-]*)-(.*)$/;\n            var matches = that.attr('id').match(regexp);\n            if (matches) {\n                var fieldtype = matches[2];\n                var readwrite = matches[3];\n                var nodeid = matches[4];\n\n                var ischecked = that.prop('checked');\n                if (ischecked === true) {\n                    // Let initial node of children\n                    $('.' + namespace + '-' + fieldtype + '-' + readwrite + ' ' + nodeid).prop('disabled', false);\n                } else {\n                    $('.' + namespace + '-' + fieldtype + '-' + readwrite + ' ' + nodeid).prop('checked', false);\n                    $('.' + namespace + '-' + fieldtype + '-' + readwrite + ' ' + nodeid).prop('disabled', true);\n                }\n                $('.' + namespace + '-' + 'widget' + '-' + nodeid).trigger('rowchange');\n            }\n        },\n\n        toggle_childs: function () {\n\n            log.debug('AMD Mod sharedresource metadata TOGGLE CHILD');\n            var that = $(this);\n\n            var regexp = /([^-]*)-([^-]*)-([^-]*)-(.*)$/;\n            var matches = that.attr('id').match(regexp);\n            if (matches) {\n                var fieldtype = matches[2];\n                var readwrite = matches[3];\n                var nodeid = matches[4];\n\n                var nodeparents = [];\n                var nodeidbuf = nodeid;\n                nodeidbuf = nodeidbuf.replace(/_[^_]+$/, '');\n                if (nodeidbuf != nodeid) {\n                    // Do not change self.\n                    var i = 0;\n                    do {\n                        // Stops when single num index.\n                        nodeparents.push(nodeidbuf);\n                        nodeidbuf = nodeidbuf.replace(/_[^_]+$/, '');\n                        i++;\n                    } while (!nodeidbuf.match(/^\\d+$/) && i < 100);\n                }\n\n                var ischecked = that.prop('checked');\n                // Check all my subdependancies.\n                if (ischecked === true) {\n                    // All childs.\n                    $('.' + namespace + '-' + fieldtype + '-' + readwrite + '-' + nodeid).prop('checked', true);\n                    $('.' + namespace + '-' + fieldtype + '-' + readwrite + '-' + nodeid).prop('disabled', false);\n\n                    // The read and child's read.\n                    if (readwrite === 'write') {\n                        // My read.\n                        $('#' + namespace + '-' + fieldtype + '-read-' + nodeid).prop('checked', true);\n                        $('#' + namespace + '-' + fieldtype + '-read-' + nodeid).prop('disabled', true);\n                        // My child's read.\n                        $('.' + namespace + '-' + fieldtype + '-read-' + nodeid).prop('checked', true);\n                        $('.' + namespace + '-' + fieldtype + '-read-' + nodeid).prop('disabled', true);\n                    }\n\n                    // Check all my parents\n                    var parentid = nodeparents.shift();\n                    while (parentid) {\n                        $('#' + namespace + '-' + fieldtype + '-' + readwrite + '-' + parentid).prop('checked', true);\n                        $('#' + namespace + '-' + fieldtype + '-' + readwrite + '-' + parentid).prop('disabled', false);\n\n                        if (readwrite === 'write') {\n                            $('#' + namespace + '-' + fieldtype + '-read-' + parentid).prop('checked', true);\n                            $('#' + namespace + '-' + fieldtype + '-read-' + parentid).prop('disabled', true);\n                        }\n                        parentid = nodeparents.shift();\n                        log.debug('AMD Mod sharedresource metadata Checking parent');\n                    }\n\n                } else {\n                    // Free constraint on childs.\n                    $('.' + namespace + '-' + fieldtype + '-' + readwrite + '-' + nodeid).prop('checked', false);\n                    $('.' + namespace + '-' + fieldtype + '-' + readwrite + '-' + nodeid).prop('disabled', true);\n\n                    if (readwrite === 'write') {\n                        // My read.\n                        $('#' + namespace + '-' + fieldtype + '-read-' + nodeid).prop('disabled', false);\n\n                        // My child's  read.\n                        $('.' + namespace + '-' + fieldtype + '-read-' + nodeid).prop('disabled', false);\n                    }\n                }\n                $('#' + namespace + '-' + 'widget' + '-' + nodeid).trigger('rowchange');\n\n            }\n        },\n\n        widget_check: function () {\n\n            log.debug('AMD Mod sharedresource metadata WIDGET CHECK');\n\n            var that = $(this);\n\n            var regexp = /([^-]*)-([^-]*)-(.*)$/;\n\n            var matches = that.attr('id').match(regexp);\n            if (matches) {\n                // var fieldtype = matches[2]; // Should be widget if proxied on a widget.\n                var nodeid = matches[3];\n\n                // Check widget if exists on same line.\n                if ($('#' + namespace + '-widget' + '-' + nodeid).length) {\n                    var schecked = $('#' + namespace + '-system-read-' + nodeid).prop('checked');\n                    var ichecked = $('#' + namespace + '-indexer-read-' + nodeid).prop('checked');\n                    var achecked = $('#' + namespace + '-author-read-' + nodeid).prop('checked');\n                    if (achecked || ichecked || schecked) {\n                        $('#' + namespace + '-widget-' + nodeid).prop('disabled', false);\n                    } else {\n                        $('#' + namespace + '-widget-' + nodeid).prop('checked', false);\n                        $('#' + namespace + '-widget-' + nodeid).prop('disabled', true);\n                    }\n                }\n            }\n        }\n    };\n});"],"names":["define","$","log","namespace","init","args","bind","this","selectall_system_write","selectall_indexer_write","selectall_author_write","selectall_system_read","selectall_indexer_read","selectall_author_read","selectall_mandatory","selectnone_system_write","selectnone_indexer_write","selectnone_author_write","selectnone_system_read","selectnone_indexer_read","selectnone_author_read","selectnone_mandatory","toggle_childs","init_parent","trigger","widget_check","debug","prop","that","matches","attr","match","fieldtype","readwrite","nodeid","nodeparents","nodeidbuf","replace","i","push","parentid","shift","length","schecked","ichecked"],"mappings":"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"}