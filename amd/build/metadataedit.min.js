<<<<<<< HEAD
define(["jquery","core/str","core/log","core/config","mod_sharedresource/metadata"],function(a,b,c,d,e){var f,g,h={init:function(d){f=d;var e=[{key:"fillprevious",component:"sharedresource"},{key:"fillcategory",component:"sharedresource"}];b.get_strings(e).done(function(a){g=a}),a(".mtd-form-addbutton").bind("click",this.add_node),a(".mtd-tab").bind("click",this.switch_tab),a(".mtd-form-input").bind("change",this.activate_add_button),a(".mtd-tab a").bind("click",function(a){a.preventDefault()});var h="."+f+"-system-read";h+=",."+f+"-indexer-read",h+=",."+f+"-author-read",a(h).bind("change",this.enable_search_widget_checkbox),a(".taxonomy-source").bind("change",this.reload_taxonomy),a("#id-mtd-form").on("change",".taxonomy-source",null,this.reload_taxonomy),c.debug("AMD Mod sharedresource metadata edition form initialized"),a(".mtd-tab").removeClass("here"),a(".mtd-tab").removeClass("current"),a("#id-menu-1").addClass("here"),a("#id-menu-1").addClass("current"),a(".mtd-content").removeClass("active"),a(".mtd-content").removeClass("on"),a(".mtd-content").addClass("off"),a("#id-tab-1").addClass("active"),a("#id-tab-1").removeClass("off"),a("#id-tab-1").addClass("on"),c.debug("AMD Mod sharedresource metadata default switch to tab General")},switch_tab:function(b){b.stopPropagation();var c=a(this);c.attr("id")||(c=c.parent());var d=c.attr("id"),e=/id-menu-([^-]+)$/,f=c.attr("id").match(e),g="id-tab-"+f[1];a(".mtd-tab").removeClass("here"),a(".mtd-tab").removeClass("current"),a("#"+d).addClass("here"),a("#"+d).addClass("current"),a(".mtd-content").removeClass("active"),a(".mtd-content").removeClass("on"),a(".mtd-content").addClass("off"),a("#"+g).addClass("active"),a("#"+g).removeClass("off"),a("#"+g).addClass("on")},add_node:function(b){b.stopPropagation();var c=a(this),d=/btn-([^-]+)-([^-]+)/,e=c.attr("name").match(d),f=e[1],i=e[2],j=c.attr("data-occur");if("category"!=i){switch(i){case"text":case"codetext":if(""===a("#"+f).val())return void alert(g[0]);break;case"select":if("basicvalue"===a("#"+f).val())return void alert(g[0]);break;case"date":if("- Year -"===a("#"+f+"_dateyear").val())return void alert(g[0]);break;case"duration":if(!(""!==a("#"+f+"_Day").val()&&"0"!==a("#"+f+"_Day").val()||""!==a("#"+f+"_Hou").val()&&"0"!==a("#"+f+"_Hou").val()||""!==a("#"+f+"_Min").val()&&"0"!==a("#"+f+"_Min").val()||""!==a("#"+f+"_Sec").val()&&"0"!==a("#"+f+"_Sec").val()))return void alert(g[0]);break;case"vcard":var k=new RegExp("(\r\n|\r|\n)","g");if("BEGIN:VCARDVERSION:FN:N:END:VCARD"===a("#"+f).val().replace(k,"").replace(/ /g,""))return void alert(g[0])}h.add_list_item(f,j)}else{for(var l,m=c.attr("data"),n=m.split(";"),o=0,p=0;p<n.length;p++)if(l=n[p],""===a("#"+l).val()&&o++,"basicvalue"===a("#"+l).val()&&o++,"-year-"===a("#"+l+"_dateyear").val()&&o++,""!==a("#"+l+"_Day").val()&&"0"!==a("#"+l+"_Day").val()||""!==a("#"+l+"_Hou").val()&&"0"!==a("#"+l+"_Hou").val()||""!==a("#"+l+"_Min").val()&&"0"!==a("#"+l+"_Min").val()||""!==a("#"+l+"_Sec").val()&&"0"!==a("#"+l+"_Sec").val()||o++,"undefined"===a("#"+l).val()){var k=new RegExp("(\r\n|\r|\n)","g");"BEGIN:VCARDVERSION:FN:N:END:VCARD"===a("#"+l).val().replace(k,"").replace(/ /g,"")&&o++}o==n.length?alert(g[1]):h.add_list_item(f,j)}},add_list_item:function(b,c){var f=e.next_occurrence_name(b);c++;var g="elementname="+f;g+="&realoccur="+c;var i=d.wwwroot+"/mod/sharedresource/ajax/getformelement.php?"+g;a.get(i,function(c){var d="#add-zone-"+b;a(c.html).insertBefore(d);var e="id-add-"+b;e=CSS.escape(e);var g="id-add-"+f;g=CSS.escape(g),a("#"+e).attr("name","btn-"+c.name),a("#"+e).attr("id",g),a("#"+g).prop("disabled",!0),a("#add-zone-"+b).attr("id","add-zone-"+f),a("#"+b).unbind("change"),a("#"+f).bind("change",h.activate_add_button)},"json")},activate_add_button:function(b){b.stopPropagation();var d=a(this),f=d.attr("id");d.val()?a("#id-add-"+f).prop("disabled",!1):a("#id-add-"+f).prop("disabled",!0);var g=f;for(c.debug("Processing to elementkey "+f),g=e.parent_name(g);g;)c.debug("Escalading to parentkey "+g),c.debug("Detected "+a("#id-add-"+g).attr("name")),c.debug("Detected "+a("#id-add-"+g).prop("disabled")),a("#id-add-"+CSS.escape(g)).prop("disabled",!1),g=e.parent_name(g)},reload_taxonomy:function(b){b.stopPropagation();var c=a(this),f=d.wwwroot+"/mod/sharedresource/ajax/gettaxonomymenu.php?id="+c.val();a.get(f,function(b){var d=e.parent_name(c.attr("id"));a('[data-source="'+d+'"]').each(function(){a(this).html(b),a(this).val("")})},"html")}};return h});
=======
define(["jquery","core/str","core/log","core/config","mod_sharedresource/metadata"],function(a,b,c,d,e){var f,g,h={bind_all:function(){c.debug("AMD Mod sharedresource metadata edition binding all events"),a(".mtd-form-input").off("change"),a(".taxonomy-source").off("change"),a(".mtd-form-addbutton").off("click"),a(".mtd-form-element select").off("change"),a(".mtd-form-element textarea").off("change"),a('.mtd-form-element input[type="text"]').off("change"),a(".mtd-tab").off("click"),a(".mtd-tab a").off("click"),a('.mtd-form-element input[type="text"]').bind("change",this.check_empty),a(".mtd-form-element select").bind("change",this.check_empty),a(".mtd-form-element textarea").bind("change",this.check_empty),a(".mtd-form-addbutton").bind("click",this.add_node),a(".mtd-tab").bind("click",this.switch_tab),a(".mtd-tab a").bind("click",function(a){a.preventDefault()});var b="."+f+"-system-read";b+=",."+f+"-indexer-read",b+=",."+f+"-author-read",a(b).off("change"),a(b).bind("change",this.enable_search_widget_checkbox),a(".taxonomy-source").bind("change",this.reload_taxonomy),a("#id-mtd-form").on("change",".taxonomy-source",null,this.reload_taxonomy)},trigger_all:function(){c.debug("AMD Mod sharedresource metadata edition triggering changes"),a('.mtd-form-element input[type="text"]').trigger("change"),a(".mtd-form-element select").trigger("change"),a(".mtd-form-element textarea").trigger("change")},init:function(d){f=d;var e=[{key:"fillprevious",component:"sharedresource"},{key:"fillcategory",component:"sharedresource"}];b.get_strings(e).done(function(a){g=a}),c.debug("AMD Mod sharedresource BIND ALL CALL"),h.bind_all(),h.trigger_all(),a(".mtd-form-addbutton").each(h.check_button_status),c.debug("AMD Mod sharedresource metadata edition form initialized"),a(".mtd-tab").removeClass("here"),a(".mtd-tab").removeClass("current"),a("#id-menu-1").addClass("here"),a("#id-menu-1").addClass("current"),a(".mtd-content").removeClass("active"),a(".mtd-content").removeClass("on"),a(".mtd-content").addClass("off"),a("#id-tab-1").addClass("active"),a("#id-tab-1").removeClass("off"),a("#id-tab-1").addClass("on"),c.debug("AMD Mod sharedresource metadata default switch to tab General")},check_button_status:function(){var b=a(this);c.debug("Check add button "+b.attr("id"));var d,e=b.attr("id").replace("id-add-",""),f=b.attr("data"),g=f.split(";"),i=!1,j="";for(d=g.shift();void 0!==d;){if(j=a("#"+d),c.debug("   Check button dep "+j.attr("id")),j.parent(".mtd-form-element").hasClass("is-empty")){i=!0;break}d=g.shift()}i?b.prop("disabled",!0):b.prop("disabled",!1),h.activate_up_chain(e)},switch_tab:function(b){b.stopPropagation();var c=a(this);c.attr("id")||(c=c.parent());var d=c.attr("id"),e=/id-menu-([^-]+)$/,f=c.attr("id").match(e),g="id-tab-"+f[1];a(".mtd-tab").removeClass("here"),a(".mtd-tab").removeClass("current"),a("#"+d).addClass("here"),a("#"+d).addClass("current"),a(".mtd-content").removeClass("active"),a(".mtd-content").removeClass("on"),a(".mtd-content").addClass("off"),a("#"+g).addClass("active"),a("#"+g).removeClass("off"),a("#"+g).addClass("on")},add_node:function(b){b.stopPropagation();var d=a(this),e=/btn-([^-]+)-([^-]+)/,f=d.attr("name").match(e),i=f[1],j=f[2],k="",l=d.attr("data-occur");if("category"!=j){switch(j){case"text":case"codetext":if(""===a("#"+i).val())return void window.alert(g[0]);break;case"select":if("basicvalue"===a("#"+i).val())return void window.alert(g[0]);break;case"date":if("- Year -"===a("#"+i+"_dateyear").val())return void window.alert(g[0]);break;case"duration":if(!(""!==a("#"+i+"_Day").val()&&"0"!==a("#"+i+"_Day").val()||""!==a("#"+i+"_Hou").val()&&"0"!==a("#"+i+"_Hou").val()||""!==a("#"+i+"_Min").val()&&"0"!==a("#"+i+"_Min").val()||""!==a("#"+i+"_Sec").val()&&"0"!==a("#"+i+"_Sec").val()))return void window.alert(g[0]);break;case"vcard":if(k=new RegExp("(\r\n|\r|\n)","g"),"BEGIN:VCARDVERSION:FN:N:END:VCARD"===a("#"+i).val().replace(k,"").replace(/ /g,""))return void window.alert(g[0])}h.add_list_item(i,l)}else{for(var m,n=d.attr("data"),o=n.split(" "),p=0,q=0;q<o.length;q++)m=o[q],""===a("#"+m).val()&&p++,"basicvalue"===a("#"+m).val()&&p++,"-year-"===a("#"+m+"_dateyear").val()&&p++,""!==a("#"+m+"_Day").val()&&"0"!==a("#"+m+"_Day").val()||""!==a("#"+m+"_Hou").val()&&"0"!==a("#"+m+"_Hou").val()||""!==a("#"+m+"_Min").val()&&"0"!==a("#"+m+"_Min").val()||""!==a("#"+m+"_Sec").val()&&"0"!==a("#"+m+"_Sec").val()||p++,"undefined"===a("#"+m).val()&&(k=new RegExp("(\r\n|\r|\n)","g"),"BEGIN:VCARDVERSION:FN:N:END:VCARD"===a("#"+m).val().replace(k,"").replace(/ /g,"")&&p++);if(p==o.length)window.alert(g[1]);else{c.debug("Get source for #"+d.attr("data"));var r=a("#"+d.attr("data"));c.debug("Get source in #"+r.attr("data-source")+"_1n0");var s=a("#"+r.attr("data-source")+"_1n0"),t=s.val();c.debug("Resulting taxonrourceid  = "+t),h.add_list_item(i,l,t)}}},add_list_item:function(b,c,f){var g="id-add-"+b,i=a("#"+g).attr("data"),j=e.next_occurrence_name(b);c++;var k="elementname="+j;f&&(k+="&taxonsourceid="+f),k+="&realoccur="+c;var l=d.wwwroot+"/mod/sharedresource/ajax/getformelement.php?"+k;a.get(l,function(d){var e="#add-zone-"+b;a(d.html).insertBefore(e),g=CSS.escape(g);var f="id-add-"+j;f=CSS.escape(f),a("#"+g).attr("name","btn-"+d.name),a("#"+g).attr("id",f),a("#"+f).prop("disabled",!0),a("#"+f).attr("data-occur",c),a("#add-zone-"+b).attr("id","add-zone-"+j),a("#"+f).attr("data",i),h.bind_all()},"json")},activate_up_chain:function(b){var d=b;for(c.debug("Processing to elementkey "+b),d=e.parent_name(d);d;)c.debug("Escalading to parentkey "+d),c.debug("Detected "+a("#id-add-"+d).attr("name")),c.debug("Detected "+a("#id-add-"+d).prop("disabled")),a("#id-add-"+CSS.escape(d)).prop("disabled",!1),d=e.parent_name(d)},reload_taxonomy:function(b){b.stopPropagation();var c=a(this),f=d.wwwroot+"/mod/sharedresource/ajax/gettaxonomymenu.php?id="+c.val();a.get(f,function(b){var d=e.parent_name(c.attr("id"));a('[data-source="'+d+'"]').each(function(){a(this).html(b),a(this).val("")})},"html")},check_empty:function(){var b=a(this);c.debug("Check "+b.attr("id"));var d=b.attr("id").substring(0,1);if(b.val()){b.parent(".mtd-form-element").removeClass("is-empty");var e=a(".mtd-form-element.is-mandatory-"+d+".is-empty");e&&0!==e.length||a("#id-menu-"+d).removeClass("is-empty");var f=a(".mtd-form-element.is-mandatory.is-empty");f&&0!==f.length||(a("#id-mtd-submit").attr("disabled",!1),a("#id-mtd-submit").removeClass("is-disabled"))}else b.parent(".mtd-form-element").addClass("is-empty"),a("#id-mtd-submit").attr("disabled",!0),a("#id-mtd-submit").addClass("is-disabled"),a("#id-menu-"+d).addClass("is-empty");var g=a('.mtd-form-addbutton[data~="'+b.attr("id")+'"]');g.each(h.check_button_status)}};return h});
>>>>>>> MOODLE_36_STABLE
