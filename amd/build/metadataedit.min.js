define ("mod_sharedresource/metadataedit",["jquery","core/str","core/log","core/config","mod_sharedresource/metadata"],function(a,b,c,d,e){var f,g,h={bind_tabs:function bind_tabs(){c.debug("AMD Mod sharedresource metadata edition binding tab events");a(".mtd-tab").bind("click",this.switch_tab);a(".mtd-tab a").bind("click",function(a){a.preventDefault()})},bind_all:function bind_all(){c.debug("AMD Mod sharedresource metadata edition binding all events");a(".mtd-form-input").off("change");a(".taxonomy-source").off("change");a(".mtd-form-addbutton").off("click");a(".mtd-form-element select").off("change");a(".mtd-form-element textarea").off("keyup");a(".mtd-form-element input[type=\"text\"]").off("keyup");a(".mtd-tab").off("click");a(".mtd-tab a").off("click");a(".mtd-form-element input[type=\"text\"]").bind("keyup",this.check_empty);a(".mtd-form-element select").bind("change",this.check_empty);a(".mtd-form-element textarea").bind("keyup",this.check_empty);a(".mtd-form-addbutton").bind("click",this.add_node);var b="."+f+"-system-read";b+=",."+f+"-indexer-read";b+=",."+f+"-author-read";a(b).off("change");a(b).bind("change",this.enable_search_widget_checkbox);a(".taxonomy-source").bind("change",this.reload_taxonomy);a("#id-mtd-form").on("change",".taxonomy-source",null,this.reload_taxonomy)},trigger_all:function trigger_all(){c.debug("AMD Mod sharedresource metadata edition triggering changes");a(".mtd-form-element input[type=\"text\"]").trigger("keyup");a(".mtd-form-element textarea").trigger("keyup")},init:function init(d){f=d;b.get_strings([{key:"fillprevious",component:"sharedresource"},{key:"fillcategory",component:"sharedresource"}]).done(function(a){g=a});c.debug("AMD Mod sharedresource BIND ALL CALL");h.bind_all();h.bind_tabs();h.trigger_all();a(".mtd-form-addbutton").each(h.check_button_status);c.debug("AMD Mod sharedresource metadata edition form initialized");a(".mtd-tab").removeClass("here");a(".mtd-tab").removeClass("current");a("#id-menu-1").addClass("here");a("#id-menu-1").addClass("current");a(".mtd-content").removeClass("active");a(".mtd-content").removeClass("on");a(".mtd-content").addClass("off");a("#id-tab-1").addClass("active");a("#id-tab-1").removeClass("off");a("#id-tab-1").addClass("on");c.debug("AMD Mod sharedresource metadata default switch to tab General")},check_button_status:function check_button_status(){var b=a(this);c.debug("Check add button "+b.attr("id"));var d=b.attr("id").replace("id-add-",""),e=b.attr("data"),f=e.split(";"),g=!1,i="",j;j=f.shift();while(j!==void 0){i=a("#"+j);c.debug("   Check button dep "+i.attr("id"));if(i.parent(".mtd-form-element").hasClass("is-empty")){g=!0;break}j=f.shift()}if(g){b.prop("disabled",!0)}else{b.prop("disabled",!1)}h.activate_up_chain(d)},switch_tab:function switch_tab(b){b.stopPropagation();var c=a(this);if(!c.attr("id")){c=c.parent()}var d=c.attr("id"),e=c.attr("id").match(/id-menu-([^-]+)$/),f="id-tab-"+e[1];a(".mtd-tab").removeClass("here");a(".mtd-tab").removeClass("current");a("#"+d).addClass("here");a("#"+d).addClass("current");a(".mtd-content").removeClass("active");a(".mtd-content").removeClass("on");a(".mtd-content").addClass("off");a("#"+f).addClass("active");a("#"+f).removeClass("off");a("#"+f).addClass("on")},add_node:function add_node(b){b.stopPropagation();var d=a(this),f=d.attr("name").match(/btn-([^-]+)-([^-]+)/),j=f[1],k=f[2],l="",m=d.attr("data-occur");c.debug("found real occur as "+m);if("category"!=k){switch(k){case"text":case"codetext":{if(""===a("#"+j).val()){window.alert(g[0]);return}break}case"select":{if("basicvalue"===a("#"+j).val()){window.alert(g[0]);return}break}case"date":{if("- Year -"===a("#"+j+"_dateyear").val()){window.alert(g[0]);return}break}case"duration":{if((""===a("#"+j+"_Day").val()||"0"===a("#"+j+"_Day").val())&&(""===a("#"+j+"_Hou").val()||"0"===a("#"+j+"_Hou").val())&&(""===a("#"+j+"_Min").val()||"0"===a("#"+j+"_Min").val())&&(""===a("#"+j+"_Sec").val()||"0"===a("#"+j+"_Sec").val())){window.alert(g[0]);return}break}case"vcard":{l=/(\r\n|\r|\n)/g;if("BEGIN:VCARDVERSION:FN:N:END:VCARD"===a("#"+j).val().replace(l,"").replace(/ /g,"")){window.alert(g[0]);return}break}}h.add_list_item(j,m)}else{for(var n=d.attr("data"),o=n.split(" "),p=0,q,r=0;r<o.length;r++){q=o[r];if(""===a("#"+q).val()){p++}if("basicvalue"===a("#"+q).val()){p++}if("-year-"===a("#"+q+"_dateyear").val()){p++}if((""===a("#"+q+"_Day").val()||"0"===a("#"+q+"_Day").val())&&(""===a("#"+q+"_Hou").val()||"0"===a("#"+q+"_Hou").val())&&(""===a("#"+q+"_Min").val()||"0"===a("#"+q+"_Min").val())&&(""===a("#"+q+"_Sec").val()||"0"===a("#"+q+"_Sec").val())){p++}if("undefined"===a("#"+q).val()){l=/(\r\n|\r|\n)/g;if("BEGIN:VCARDVERSION:FN:N:END:VCARD"===a("#"+q).val().replace(l,"").replace(/ /g,"")){p++}}}if(p==o.length){window.alert(g[1])}else{var s=d.attr("data").split(" "),t=s.pop();c.debug("Get source taxon in #"+e.parent_name(t)+"_1n0");var u=a("#"+e.parent_name(t)+"_1n0"),v=u.val();c.debug("Resulting taxonresourceid  = "+v);h.add_list_item(j,m,v)}}},add_list_item:function add_list_item(b,f,g){var i="id-add-"+b,j=a("#"+i).attr("data"),k=e.next_occurrence_name(b);f++;c.debug("Next real occur is "+f);var l="elementname="+k;if(g){l+="&taxonsourceid="+g}l+="&realoccur="+f;var m=d.wwwroot+"/mod/sharedresource/ajax/getformelement.php?"+l;a.get(m,function(d){a(d.html).insertBefore("#add-zone-"+b);i=CSS.escape(i);var e="id-add-"+k;e=CSS.escape(e);a("#"+i).attr("name","btn-"+d.name);a("#"+i).attr("id",e);a("#"+e).prop("disabled",!0);a("#"+e).attr("data-occur",f);c.debug("Shifting button "+e+" real occur as "+f);a("#add-zone-"+b).attr("id","add-zone-"+k);a("#"+e).attr("data",j);h.bind_all();h.bind_tabs()},"json")},activate_up_chain:function activate_up_chain(b){var d=b;c.debug("Processing to elementkey "+b);d=e.parent_name(d);while(d){c.debug("Escalading to parentkey "+d);c.debug("Detected "+a("#id-add-"+d).attr("name"));c.debug("Detected "+a("#id-add-"+d).prop("disabled"));a("#id-add-"+CSS.escape(d)).prop("disabled",!1);d=e.parent_name(d)}},reload_taxonomy:function reload_taxonomy(b){b.stopPropagation();var c=a(this),f=d.wwwroot+"/mod/sharedresource/ajax/gettaxonomymenu.php?id="+c.val();a.get(f,function(b){var d=e.parent_name(c.attr("id"));a("[data-source=\""+d+"\"]").each(function(){a(this).html(b);a(this).val("")})},"html")},check_empty:function check_empty(){var b=a(this);c.debug("Check "+b.attr("id"));var d=b.attr("id").substring(0,1);if(b.val()){b.parent(".mtd-form-element").removeClass("is-empty");var e=a(".mtd-form-element.is-mandatory-"+d+".is-empty");if(!e||0===e.length){a("#id-menu-"+d).removeClass("is-empty")}var f=a(".mtd-form-element.is-mandatory.is-empty");if(!f||0===f.length){a("#id-mtd-submit").attr("disabled",!1);a("#id-mtd-submit").removeClass("is-disabled")}}else{b.parent(".mtd-form-element").addClass("is-empty");if(b.hasClass("is-mandatory")){a("#id-mtd-submit").attr("disabled",!0);a("#id-mtd-submit").addClass("is-disabled");a("#id-menu-"+d).addClass("is-empty")}}var g=a("input[name^=\"btn-"+b.attr("id")+"-\"]");g.each(h.check_button_status)}};return h});
//# sourceMappingURL=metadataedit.min.js.map
