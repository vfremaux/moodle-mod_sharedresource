{"version":3,"file":"metadataedit.min.js","sources":["../src/metadataedit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for editing metadata\n * @module     mod_sharedresource/view\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:true\ndefine(['jquery', 'core/str', 'core/log', 'core/config', 'mod_sharedresource/metadata'], function ($, str, log, cfg, metadata) {\n\n    var namespace;\n    var mtdstrings;\n\n    var metadataedit = {\n\n        bind_tabs: function() {\n            log.debug('AMD Mod sharedresource metadata edition binding tab events');\n            $('.mtd-tab').bind('click', this.switch_tab);\n            $('.mtd-tab a').bind('click', function(e) { e.preventDefault(); });\n        },\n\n        bind_all: function() {\n\n            log.debug('AMD Mod sharedresource metadata edition binding all events');\n\n            $('.mtd-form-input').off('change');\n            $('.taxonomy-source').off('change');\n            $('.mtd-form-addbutton').off('click');\n            $('.mtd-form-element select').off('change');\n            $('.mtd-form-element textarea').off('keyup');\n            $('.mtd-form-element input[type=\"text\"]').off('keyup');\n            $('.mtd-tab').off('click');\n            $('.mtd-tab a').off('click');\n\n            // Add check handlers to all elements.\n            $('.mtd-form-element input[type=\"text\"]').bind('keyup', this.check_empty);\n            $('.mtd-form-element select').bind('change', this.check_empty);\n            $('.mtd-form-element textarea').bind('keyup', this.check_empty);\n\n            $('.mtd-form-addbutton').bind('click', this.add_node);\n\n            // Read checkboxes may ask search widget being enabled.\n            var selector = '.' + namespace + '-system-read';\n            selector += ',.' + namespace + '-indexer-read';\n            selector += ',.' + namespace + '-author-read';\n            $(selector).off('change');\n            $(selector).bind('change', this.enable_search_widget_checkbox);\n\n            $('.taxonomy-source').bind('change', this.reload_taxonomy);\n            // Change to this form : indefinitely add binding to all now and future elements.\n            $('#id-mtd-form').on('change', '.taxonomy-source', null, this.reload_taxonomy);\n        },\n\n        trigger_all: function() {\n            log.debug('AMD Mod sharedresource metadata edition triggering changes');\n            $('.mtd-form-element input[type=\"text\"]').trigger('keyup');\n            // On selects, triggering empties preload choices on taxonomy.\n            // $('.mtd-form-element select').trigger('change');\n            $('.mtd-form-element.is-mandatory-1 select').trigger('change');\n            $('.mtd-form-element.is-mandatory-2 select').trigger('change');\n            $('.mtd-form-element.is-mandatory-3 select').trigger('change');\n            $('.mtd-form-element.is-mandatory-4 select').trigger('change');\n            $('.mtd-form-element.is-mandatory-5 select').trigger('change');\n            $('.mtd-form-element.is-mandatory-6 select').trigger('change');\n            $('.mtd-form-element.is-mandatory-7 select').trigger('change');\n            $('.mtd-form-element textarea').trigger('keyup');\n        },\n\n        init: function(args) {\n\n            namespace = args;\n\n            var stringsreq = [\n                {\n                    key: 'fillprevious',\n                    component: 'sharedresource'\n                },\n                {\n                    key: 'fillcategory',\n                    component: 'sharedresource'\n                },\n            ];\n\n            str.get_strings(stringsreq).done(function(strings) {\n                mtdstrings = strings;\n            });\n\n            log.debug('AMD Mod sharedresource BIND ALL CALL');\n            metadataedit.bind_all();\n            metadataedit.bind_tabs();\n            metadataedit.trigger_all();\n\n            // check and set the initial button state.\n            $('.mtd-form-addbutton').each(metadataedit.check_button_status);\n\n            log.debug('AMD Mod sharedresource metadata edition form initialized');\n\n            $('.mtd-tab').removeClass('here');\n            $('.mtd-tab .nav-link').removeClass('active');\n            $('#id-menu-1').addClass('here');\n            $('#id-menu-1 .nav-link').addClass('active');\n\n            $('.mtd-content').removeClass('active');\n            $('.mtd-content').removeClass('on');\n            $('.mtd-content').addClass('off');\n            $('#id-tab-1').addClass('active');\n            $('#id-tab-1').removeClass('off');\n            $('#id-tab-1').addClass('on');\n\n            log.debug('AMD Mod sharedresource metadata default switch to tab General');\n        },\n\n        check_button_status: function() {\n            var that = $(this);\n            log.debug('Check add button ' + that.attr('id'));\n            var elementname = that.attr('id').replace('id-add-', '');\n            var deps = that.attr('data');\n            var depsarr = deps.split(';');\n            var hassomeempty = false;\n            var depelm = '';\n            var dep;\n\n            dep = depsarr.shift();\n            while (dep !== undefined) {\n                depelm = $('#' + dep);\n                log.debug('   Check button dep ' + depelm.attr('id'));\n                if (depelm.parent('.mtd-form-element').hasClass('is-empty')) {\n                    hassomeempty = true;\n                    break;\n                }\n                dep = depsarr.shift();\n            }\n\n            if (hassomeempty) {\n                that.prop('disabled', true);\n            } else {\n                that.prop('disabled', false);\n            }\n\n            metadataedit.activate_up_chain(elementname);\n        },\n\n        switch_tab: function(e) {\n\n            e.stopPropagation();\n\n            // Target is a form tab link, or a form tab LI.\n            var that = $(this);\n            if (!that.attr('id')) {\n                that = that.parent();\n            }\n\n            var menuid = that.attr('id');\n\n            var regexp = /id-menu-([^-]+)$/;\n            var matches = that.attr('id').match(regexp);\n            var tabid = 'id-tab-' + matches[1];\n\n            $('.mtd-tab').removeClass('here');\n            $('.mtd-tab .nav-link').removeClass('active');\n            $('#' + menuid).addClass('here');\n            $('#' + menuid + ' .nav-link').addClass('active');\n\n            $('.mtd-content').removeClass('active');\n            $('.mtd-content').removeClass('on');\n            $('.mtd-content').addClass('off');\n            $('#' + tabid).addClass('active');\n            $('#' + tabid).removeClass('off');\n            $('#' + tabid).addClass('on');\n        },\n\n        add_node: function(e) {\n\n            e.stopPropagation();\n\n            // Target is the add button.\n            var that = $(this);\n\n            // Comes in order : \"btn-$elmname-$fieldtype\"\n            /*\n             * elmname : the complete occurence id as xny_wnz (ex : 1n1_1n2, which is the JS id\n             * base for the second instance of element 1_1\n             * fieldtype : typeof field\n             */\n            var regexp = /btn-([^-]+)-([^-]+)/;\n            var matches = that.attr('name').match(regexp);\n\n            var elmid = matches[1];\n            var fieldtype = matches[2];\n            var rgx = '';\n\n            var realoccur = that.attr('data-occur');\n            log.debug(\"found real occur as \" + realoccur);\n\n            if (fieldtype != 'category') {\n                switch (fieldtype) {\n                    case 'text':\n                    case 'codetext': {\n                        if ($('#' + elmid).val() === '') {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n\n                    case 'select': {\n                        if ($('#' + elmid).val() === 'basicvalue') {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n\n                    case 'date': {\n                        if ($('#' + elmid + \"_dateyear\").val() === '- Year -') {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n\n                    case 'duration': {\n                        if (($('#' + elmid+\"_Day\").val() === '' || $('#' + elmid + \"_Day\").val() === '0') &&\n                            ($('#' + elmid + \"_Hou\").val() === '' || $('#' + elmid + \"_Hou\").val() === '0') &&\n                                ($('#' + elmid + \"_Min\").val() === '' || $('#' + elmid + \"_Min\").val() === '0') &&\n                                    ($('#' + elmid + \"_Sec\").val() === '' || $('#' + elmid+\"_Sec\").val() === '0')) {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n\n                    case 'vcard': {\n                        // eslint-disable-next-line no-control-regex\n                        rgx = new RegExp(\"(\\r\\n|\\r|\\n)\", \"g\");\n                        if ($('#' + elmid).val().replace(rgx,'').replace(/ /g, '') === 'BEGIN:VCARDVERSION:FN:N:END:VCARD') {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n                }\n\n                metadataedit.add_list_item(elmid, realoccur);\n            } else {\n                // This is a category. We need adding a full new branch.\n                //  Check we really need to add an item (something filled in the subs  ?)\n                var listchildren = that.attr('data');\n                var listtab = listchildren.split(' ');\n                var nbremptyfield = 0;\n                var childid;\n\n                for (var i = 0; i < listtab.length; i++) {\n\n                    childid = listtab[i];\n\n                    if ($('#' + childid).val() === '') {\n                        nbremptyfield++;\n                    }\n                    if ($('#' + childid).val() === 'basicvalue') {\n                        nbremptyfield++;\n                    }\n                    if ($('#' + childid + \"_dateyear\").val() === '-year-') {\n                        nbremptyfield++;\n                    }\n                    if (($('#' + childid + \"_Day\").val() === '' || $('#' + childid + \"_Day\").val() === '0') &&\n                        ($('#' + childid + \"_Hou\").val() === '' || $('#' + childid + \"_Hou\").val() === '0') &&\n                            ($('#' + childid + \"_Min\").val() === '' || $('#' + childid + \"_Min\").val() === '0') &&\n                                ($('#' + childid + \"_Sec\").val() === '' || $('#' + childid + \"_Sec\").val() === '0') ) {\n                        nbremptyfield++;\n                    }\n                    if ($('#' + childid).val() === 'undefined') {\n                        // eslint-disable-next-line no-control-regex\n                        rgx = new RegExp(\"(\\r\\n|\\r|\\n)\", \"g\" );\n                        if ($('#' + childid).val().replace(rgx, '').replace(/ /g, '') === 'BEGIN:VCARDVERSION:FN:N:END:VCARD') {\n                            nbremptyfield++;\n                        }\n                    }\n                }\n\n                if (nbremptyfield == listtab.length) {\n                    window.alert(mtdstrings[1]);\n                } else {\n                    // Our current taxonsource can be found by following the route :\n                    // 1. button clicked has last taxon in 'data'.\n                    // 2. last taxon select has its source select ref in 'source'\n                    // 3. source select has current value of taxon source\n                    var sourcetaxons = that.attr('data').split(' ');\n                    var basetaxon = sourcetaxons.pop();\n                    log.debug(\"Get source taxon in #\" + metadata.parent_name(basetaxon) + '_1n0');\n                    var sourceselect = $('#' + metadata.parent_name(basetaxon) + '_1n0');\n                    var taxonsourceid = sourceselect.val();\n                    log.debug(\"Resulting taxonresourceid  = \" + taxonsourceid);\n\n                    metadataedit.add_list_item(elmid, realoccur, taxonsourceid);\n                }\n            }\n        },\n\n        /**\n         * Calls an ajax renderer to produce a new form subtree fragment.\n         * @param {string} elmname the element id\n         * @param {int} realoccur the occurence index\n         * @param {string} taxonsourceid the occurence index\n         */\n        add_list_item: function(elmname, realoccur, taxonsourceid) {\n\n            var oldid = 'id-add-' + elmname;\n            var olddata = $('#' + oldid).attr('data');\n\n            var newname = metadata.next_occurrence_name(elmname);\n            realoccur++;\n            log.debug(\"Next real occur is \" + realoccur);\n\n            // Get form fragment for next occurrence.\n            var params = \"elementname=\" + newname;\n            if (taxonsourceid) {\n                params += \"&taxonsourceid=\" + taxonsourceid;\n            }\n            params += \"&realoccur=\" + realoccur;\n            var url = cfg.wwwroot + \"/mod/sharedresource/ajax/getformelement.php?\" + params;\n\n            $.get(url, function(data) {\n                var zonename = \"#add-zone-\" + elmname;\n                $(data.html).insertBefore(zonename);\n\n                // Recode the add button id for next play, incrementing occurence index.\n                oldid = CSS.escape(oldid);\n\n                var newid = 'id-add-' + newname;\n                newid = CSS.escape(newid);\n\n                // We get the new incremented occurrence name from AJAX return.\n                $('#' + oldid).attr('name', 'btn-' + data.name);\n                // Change the button id so next press launches query for next occurence.\n                $('#' + oldid).attr('id', newid);\n                $('#' + newid).prop('disabled', true);\n                $('#' + newid).attr('data-occur', realoccur);\n                log.debug(\"Shifting button \" + newid + \" real occur as \" + realoccur);\n                // Shift add zone name to match new button.\n                $('#add-zone-' + elmname).attr('id', 'add-zone-' + newname);\n                $('#' + newid).attr('data', olddata);\n\n                // Rebind all change handlers, including on new elements.\n                metadataedit.bind_all();\n                metadataedit.bind_tabs();\n\n            }, 'json');\n        },\n\n        activate_up_chain: function(elementname) {\n\n            // Unlock upper buttons in chain.\n            var parentname = elementname;\n            log.debug(\"Processing to elementkey \" + elementname);\n            parentname = metadata.parent_name(parentname);\n            while (parentname) {\n                log.debug(\"Escalading to parentkey \" + parentname);\n                log.debug(\"Detected \" + $('#id-add-' + parentname).attr('name'));\n                log.debug(\"Detected \" + $('#id-add-' + parentname).prop('disabled'));\n                $('#id-add-' + CSS.escape(parentname)).prop('disabled', false);\n                parentname = metadata.parent_name(parentname);\n            }\n        },\n\n        reload_taxonomy: function(e) {\n\n            e.stopPropagation();\n\n            var that = $(this);\n\n            // Fetch new taxonomy.\n            var url = cfg.wwwroot + '/mod/sharedresource/ajax/gettaxonomymenu.php?id=' + that.val();\n            $.get(url, function(data){\n\n                var parentid = metadata.parent_name(that.attr('id'));\n\n                // Clear out all values and change option list.\n                $('[data-source=\"' + parentid + '\"]').each(function() {\n                    $(this).html(data);\n                    $(this).val('');\n                });\n\n            }, 'html');\n\n        },\n\n        check_empty: function() {\n            var that = $(this);\n            log.debug(\"Check \" + that.attr('id'));\n            var branchid = that.attr('id').substring(0, 1);\n\n            if (that.val()) {\n                // mark element as fullfilled.\n                that.parent('.mtd-form-element').removeClass('is-empty');\n\n                // mark same branch tab as fullfilled.\n                var otheremptyonbranch = $('.mtd-form-element.is-mandatory-' + branchid + '.is-empty');\n                if (!otheremptyonbranch || (otheremptyonbranch.length === 0)) {\n                    $('#id-menu-' + branchid).removeClass('is-empty');\n                }\n\n                // unlock form submit if no more empty on whole form.\n                var otherempty = $('.mtd-form-element.is-mandatory.is-empty');\n                if (!otherempty || (otherempty.length === 0)) {\n                    log.debug(\"Lock form \");\n                    $('#id-mtd-submit').attr('disabled', false);\n                    $('#id-mtd-submit').removeClass('is-disabled');\n                }\n\n            } else {\n                // mark element as empty.\n                that.parent('.mtd-form-element').addClass('is-empty');\n\n                if (that.parent('.mtd-form-element').hasClass('is-mandatory')) {\n                    // lock form submit if some mandatory element is empty.\n                    log.debug(\"Unlock form \");\n                    $('#id-mtd-submit').attr('disabled', true);\n                    $('#id-mtd-submit').addClass('is-disabled');\n\n                    // mark same branch tab as empty.\n                    $('#id-menu-' + branchid).addClass('is-empty');\n                }\n            }\n\n            // Whatever the result, search the potentially affected buttons and update them.\n            var affectedaddbtns = $('input[name^=\"btn-' + that.attr('id') + '-\"]');\n            affectedaddbtns.each(metadataedit.check_button_status);\n        }\n    };\n\n    return metadataedit;\n});"],"names":["define","$","str","log","cfg","metadata","namespace","mtdstrings","metadataedit","bind_tabs","debug","bind","this","switch_tab","e","preventDefault","bind_all","off","check_empty","add_node","selector","enable_search_widget_checkbox","reload_taxonomy","on","trigger_all","trigger","init","args","get_strings","key","component","done","strings","each","check_button_status","removeClass","addClass","that","attr","dep","elementname","replace","depsarr","split","hassomeempty","depelm","shift","undefined","parent","hasClass","prop","activate_up_chain","stopPropagation","menuid","tabid","match","matches","elmid","fieldtype","rgx","realoccur","val","window","alert","RegExp","add_list_item","childid","listtab","nbremptyfield","i","length","basetaxon","pop","parent_name","taxonsourceid","elmname","oldid","olddata","newname","next_occurrence_name","params","url","wwwroot","get","data","zonename","html","insertBefore","CSS","escape","newid","name","parentname","parentid","branchid","substring","otheremptyonbranch","otherempty"],"mappings":";;;;;AAqBAA,yCAAO,CAAC,SAAU,WAAY,WAAY,cAAe,gCAAgC,SAAUC,EAAGC,IAAKC,IAAKC,IAAKC,cAE7GC,UACAC,WAEAC,aAAe,CAEfC,UAAW,WACPN,IAAIO,MAAM,8DACVT,EAAE,YAAYU,KAAK,QAASC,KAAKC,YACjCZ,EAAE,cAAcU,KAAK,SAAS,SAASG,GAAKA,EAAEC,qBAGlDC,SAAU,WAENb,IAAIO,MAAM,8DAEVT,EAAE,mBAAmBgB,IAAI,UACzBhB,EAAE,oBAAoBgB,IAAI,UAC1BhB,EAAE,uBAAuBgB,IAAI,SAC7BhB,EAAE,4BAA4BgB,IAAI,UAClChB,EAAE,8BAA8BgB,IAAI,SACpChB,EAAE,wCAAwCgB,IAAI,SAC9ChB,EAAE,YAAYgB,IAAI,SAClBhB,EAAE,cAAcgB,IAAI,SAGpBhB,EAAE,wCAAwCU,KAAK,QAASC,KAAKM,aAC7DjB,EAAE,4BAA4BU,KAAK,SAAUC,KAAKM,aAClDjB,EAAE,8BAA8BU,KAAK,QAASC,KAAKM,aAEnDjB,EAAE,uBAAuBU,KAAK,QAASC,KAAKO,cAGxCC,SAAW,IAAMd,UAAY,eACjCc,UAAY,KAAOd,UAAY,gBAE/BL,EADAmB,UAAY,KAAOd,UAAY,gBACnBW,IAAI,UAChBhB,EAAEmB,UAAUT,KAAK,SAAUC,KAAKS,+BAEhCpB,EAAE,oBAAoBU,KAAK,SAAUC,KAAKU,iBAE1CrB,EAAE,gBAAgBsB,GAAG,SAAU,mBAAoB,KAAMX,KAAKU,kBAGlEE,YAAa,WACTrB,IAAIO,MAAM,8DACVT,EAAE,wCAAwCwB,QAAQ,SAGlDxB,EAAE,2CAA2CwB,QAAQ,UACrDxB,EAAE,2CAA2CwB,QAAQ,UACrDxB,EAAE,2CAA2CwB,QAAQ,UACrDxB,EAAE,2CAA2CwB,QAAQ,UACrDxB,EAAE,2CAA2CwB,QAAQ,UACrDxB,EAAE,2CAA2CwB,QAAQ,UACrDxB,EAAE,2CAA2CwB,QAAQ,UACrDxB,EAAE,8BAA8BwB,QAAQ,UAG5CC,KAAM,SAASC,MAEXrB,UAAYqB,KAaZzB,IAAI0B,YAXa,CACb,CACIC,IAAK,eACLC,UAAW,kBAEf,CACID,IAAK,eACLC,UAAW,oBAISC,MAAK,SAASC,SACtCzB,WAAayB,WAGjB7B,IAAIO,MAAM,wCACVF,aAAaQ,WACbR,aAAaC,YACbD,aAAagB,cAGbvB,EAAE,uBAAuBgC,KAAKzB,aAAa0B,qBAE3C/B,IAAIO,MAAM,4DAEVT,EAAE,YAAYkC,YAAY,QAC1BlC,EAAE,sBAAsBkC,YAAY,UACpClC,EAAE,cAAcmC,SAAS,QACzBnC,EAAE,wBAAwBmC,SAAS,UAEnCnC,EAAE,gBAAgBkC,YAAY,UAC9BlC,EAAE,gBAAgBkC,YAAY,MAC9BlC,EAAE,gBAAgBmC,SAAS,OAC3BnC,EAAE,aAAamC,SAAS,UACxBnC,EAAE,aAAakC,YAAY,OAC3BlC,EAAE,aAAamC,SAAS,MAExBjC,IAAIO,MAAM,kEAGdwB,oBAAqB,eACbG,KAAOpC,EAAEW,MACbT,IAAIO,MAAM,oBAAsB2B,KAAKC,KAAK,WAMtCC,IALAC,YAAcH,KAAKC,KAAK,MAAMG,QAAQ,UAAW,IAEjDC,QADOL,KAAKC,KAAK,QACFK,MAAM,KACrBC,cAAe,EACfC,OAAS,OAGbN,IAAMG,QAAQI,aACCC,IAARR,KAAmB,IACtBM,OAAS5C,EAAE,IAAMsC,KACjBpC,IAAIO,MAAM,uBAAyBmC,OAAOP,KAAK,OAC3CO,OAAOG,OAAO,qBAAqBC,SAAS,YAAa,CACzDL,cAAe,QAGnBL,IAAMG,QAAQI,QAGdF,aACAP,KAAKa,KAAK,YAAY,GAEtBb,KAAKa,KAAK,YAAY,GAG1B1C,aAAa2C,kBAAkBX,cAGnC3B,WAAY,SAASC,GAEjBA,EAAEsC,sBAGEf,KAAOpC,EAAEW,MACRyB,KAAKC,KAAK,QACXD,KAAOA,KAAKW,cAGZK,OAAShB,KAAKC,KAAK,MAInBgB,MAAQ,UADEjB,KAAKC,KAAK,MAAMiB,MADjB,oBAEmB,GAEhCtD,EAAE,YAAYkC,YAAY,QAC1BlC,EAAE,sBAAsBkC,YAAY,UACpClC,EAAE,IAAMoD,QAAQjB,SAAS,QACzBnC,EAAE,IAAMoD,OAAS,cAAcjB,SAAS,UAExCnC,EAAE,gBAAgBkC,YAAY,UAC9BlC,EAAE,gBAAgBkC,YAAY,MAC9BlC,EAAE,gBAAgBmC,SAAS,OAC3BnC,EAAE,IAAMqD,OAAOlB,SAAS,UACxBnC,EAAE,IAAMqD,OAAOnB,YAAY,OAC3BlC,EAAE,IAAMqD,OAAOlB,SAAS,OAG5BjB,SAAU,SAASL,GAEfA,EAAEsC,sBAGEf,KAAOpC,EAAEW,MAST4C,QAAUnB,KAAKC,KAAK,QAAQiB,MADnB,uBAGTE,MAAQD,QAAQ,GAChBE,UAAYF,QAAQ,GACpBG,IAAM,GAENC,UAAYvB,KAAKC,KAAK,iBAC1BnC,IAAIO,MAAM,uBAAyBkD,WAElB,YAAbF,UAAyB,QACjBA,eACC,WACA,cAC4B,KAAzBzD,EAAE,IAAMwD,OAAOI,kBACfC,OAAOC,MAAMxD,WAAW,cAM3B,YAC4B,eAAzBN,EAAE,IAAMwD,OAAOI,kBACfC,OAAOC,MAAMxD,WAAW,cAM3B,UAC0C,aAAvCN,EAAE,IAAMwD,MAAQ,aAAaI,kBAC7BC,OAAOC,MAAMxD,WAAW,cAM3B,gBACoC,KAAhCN,EAAE,IAAMwD,MAAM,QAAQI,OAAkD,MAAlC5D,EAAE,IAAMwD,MAAQ,QAAQI,OAC5B,KAAlC5D,EAAE,IAAMwD,MAAQ,QAAQI,OAAkD,MAAlC5D,EAAE,IAAMwD,MAAQ,QAAQI,OAC1B,KAAlC5D,EAAE,IAAMwD,MAAQ,QAAQI,OAAkD,MAAlC5D,EAAE,IAAMwD,MAAQ,QAAQI,OAC1B,KAAlC5D,EAAE,IAAMwD,MAAQ,QAAQI,OAAgD,MAAhC5D,EAAE,IAAMwD,MAAM,QAAQI,mBACvEC,OAAOC,MAAMxD,WAAW,cAM3B,WAEDoD,IAAM,IAAIK,OAAO,eAAgB,KAC8B,sCAA3D/D,EAAE,IAAMwD,OAAOI,MAAMpB,QAAQkB,IAAI,IAAIlB,QAAQ,KAAM,gBACnDqB,OAAOC,MAAMxD,WAAW,IAOpCC,aAAayD,cAAcR,MAAOG,eAC/B,SAMCM,QAFAC,QADe9B,KAAKC,KAAK,QACFK,MAAM,KAC7ByB,cAAgB,EAGXC,EAAI,EAAGA,EAAIF,QAAQG,OAAQD,IAEhCH,QAAUC,QAAQE,GAEa,KAA3BpE,EAAE,IAAMiE,SAASL,OACjBO,gBAE2B,eAA3BnE,EAAE,IAAMiE,SAASL,OACjBO,gBAEyC,WAAzCnE,EAAE,IAAMiE,QAAU,aAAaL,OAC/BO,gBAEqC,KAApCnE,EAAE,IAAMiE,QAAU,QAAQL,OAAoD,MAApC5D,EAAE,IAAMiE,QAAU,QAAQL,OAChC,KAApC5D,EAAE,IAAMiE,QAAU,QAAQL,OAAoD,MAApC5D,EAAE,IAAMiE,QAAU,QAAQL,OAC5B,KAApC5D,EAAE,IAAMiE,QAAU,QAAQL,OAAoD,MAApC5D,EAAE,IAAMiE,QAAU,QAAQL,OAC5B,KAApC5D,EAAE,IAAMiE,QAAU,QAAQL,OAAoD,MAApC5D,EAAE,IAAMiE,QAAU,QAAQL,OAC7EO,gBAE2B,cAA3BnE,EAAE,IAAMiE,SAASL,QAEjBF,IAAM,IAAIK,OAAO,eAAgB,KACiC,sCAA9D/D,EAAE,IAAMiE,SAASL,MAAMpB,QAAQkB,IAAK,IAAIlB,QAAQ,KAAM,KACtD2B,oBAKRA,eAAiBD,QAAQG,OACzBR,OAAOC,MAAMxD,WAAW,QACrB,KAMCgE,UADelC,KAAKC,KAAK,QAAQK,MAAM,KACd6B,MAC7BrE,IAAIO,MAAM,wBAA0BL,SAASoE,YAAYF,WAAa,YAElEG,cADezE,EAAE,IAAMI,SAASoE,YAAYF,WAAa,QAC5BV,MACjC1D,IAAIO,MAAM,gCAAkCgE,eAE5ClE,aAAayD,cAAcR,MAAOG,UAAWc,kBAWzDT,cAAe,SAASU,QAASf,UAAWc,mBAEpCE,MAAQ,UAAYD,QACpBE,QAAU5E,EAAE,IAAM2E,OAAOtC,KAAK,QAE9BwC,QAAUzE,SAAS0E,qBAAqBJ,SAC5Cf,YACAzD,IAAIO,MAAM,sBAAwBkD,eAG9BoB,OAAS,eAAiBF,QAC1BJ,gBACAM,QAAU,kBAAoBN,eAElCM,QAAU,cAAgBpB,cACtBqB,IAAM7E,IAAI8E,QAAU,+CAAiDF,OAEzE/E,EAAEkF,IAAIF,KAAK,SAASG,UACZC,SAAW,aAAeV,QAC9B1E,EAAEmF,KAAKE,MAAMC,aAAaF,UAG1BT,MAAQY,IAAIC,OAAOb,WAEfc,MAAQ,UAAYZ,QACxBY,MAAQF,IAAIC,OAAOC,OAGnBzF,EAAE,IAAM2E,OAAOtC,KAAK,OAAQ,OAAS8C,KAAKO,MAE1C1F,EAAE,IAAM2E,OAAOtC,KAAK,KAAMoD,OAC1BzF,EAAE,IAAMyF,OAAOxC,KAAK,YAAY,GAChCjD,EAAE,IAAMyF,OAAOpD,KAAK,aAAcsB,WAClCzD,IAAIO,MAAM,mBAAqBgF,MAAQ,kBAAoB9B,WAE3D3D,EAAE,aAAe0E,SAASrC,KAAK,KAAM,YAAcwC,SACnD7E,EAAE,IAAMyF,OAAOpD,KAAK,OAAQuC,SAG5BrE,aAAaQ,WACbR,aAAaC,cAEd,SAGP0C,kBAAmB,SAASX,iBAGpBoD,WAAapD,gBACjBrC,IAAIO,MAAM,4BAA8B8B,aACxCoD,WAAavF,SAASoE,YAAYmB,YAC3BA,YACHzF,IAAIO,MAAM,2BAA6BkF,YACvCzF,IAAIO,MAAM,YAAcT,EAAE,WAAa2F,YAAYtD,KAAK,SACxDnC,IAAIO,MAAM,YAAcT,EAAE,WAAa2F,YAAY1C,KAAK,aACxDjD,EAAE,WAAauF,IAAIC,OAAOG,aAAa1C,KAAK,YAAY,GACxD0C,WAAavF,SAASoE,YAAYmB,aAI1CtE,gBAAiB,SAASR,GAEtBA,EAAEsC,sBAEEf,KAAOpC,EAAEW,MAGTqE,IAAM7E,IAAI8E,QAAU,mDAAqD7C,KAAKwB,MAClF5D,EAAEkF,IAAIF,KAAK,SAASG,UAEZS,SAAWxF,SAASoE,YAAYpC,KAAKC,KAAK,OAG9CrC,EAAE,iBAAmB4F,SAAW,MAAM5D,MAAK,WACvChC,EAAEW,MAAM0E,KAAKF,MACbnF,EAAEW,MAAMiD,IAAI,SAGjB,SAIP3C,YAAa,eACLmB,KAAOpC,EAAEW,MACbT,IAAIO,MAAM,SAAW2B,KAAKC,KAAK,WAC3BwD,SAAWzD,KAAKC,KAAK,MAAMyD,UAAU,EAAG,MAExC1D,KAAKwB,MAAO,CAEZxB,KAAKW,OAAO,qBAAqBb,YAAY,gBAGzC6D,mBAAqB/F,EAAE,kCAAoC6F,SAAW,aACrEE,oBAAqD,IAA9BA,mBAAmB1B,QAC3CrE,EAAE,YAAc6F,UAAU3D,YAAY,gBAItC8D,WAAahG,EAAE,2CACdgG,YAAqC,IAAtBA,WAAW3B,SAC3BnE,IAAIO,MAAM,cACVT,EAAE,kBAAkBqC,KAAK,YAAY,GACrCrC,EAAE,kBAAkBkC,YAAY,qBAKpCE,KAAKW,OAAO,qBAAqBZ,SAAS,YAEtCC,KAAKW,OAAO,qBAAqBC,SAAS,kBAE1C9C,IAAIO,MAAM,gBACVT,EAAE,kBAAkBqC,KAAK,YAAY,GACrCrC,EAAE,kBAAkBmC,SAAS,eAG7BnC,EAAE,YAAc6F,UAAU1D,SAAS,aAKrBnC,EAAE,oBAAsBoC,KAAKC,KAAK,MAAQ,OAChDL,KAAKzB,aAAa0B,8BAInC1B"}