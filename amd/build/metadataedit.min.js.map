{"version":3,"sources":["../src/metadataedit.js"],"names":["define","$","str","log","cfg","metadata","namespace","mtdstrings","metadataedit","bind_tabs","debug","bind","switch_tab","e","preventDefault","bind_all","off","check_empty","add_node","selector","enable_search_widget_checkbox","reload_taxonomy","on","trigger_all","trigger","init","args","get_strings","key","component","done","strings","each","check_button_status","removeClass","addClass","that","attr","elementname","replace","deps","depsarr","split","hassomeempty","depelm","dep","shift","parent","hasClass","prop","activate_up_chain","stopPropagation","menuid","regexp","matches","match","tabid","elmid","fieldtype","rgx","realoccur","val","window","alert","add_list_item","listchildren","listtab","nbremptyfield","childid","i","length","sourcetaxons","basetaxon","pop","parent_name","sourceselect","taxonsourceid","elmname","oldid","olddata","newname","next_occurrence_name","params","url","wwwroot","get","data","html","insertBefore","CSS","escape","newid","name","parentname","parentid","branchid","substring","otheremptyonbranch","otherempty","affectedaddbtns"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for editing metadata\n * @module     mod_sharedresource/view\n * @package    blocks\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:true\ndefine(['jquery', 'core/str', 'core/log', 'core/config', 'mod_sharedresource/metadata'], function ($, str, log, cfg, metadata) {\n\n    var namespace;\n    var mtdstrings;\n\n    var metadataedit = {\n\n        bind_tabs: function() {\n            log.debug('AMD Mod sharedresource metadata edition binding tab events');\n            $('.mtd-tab').bind('click', this.switch_tab);\n            $('.mtd-tab a').bind('click', function(e) { e.preventDefault(); });\n        },\n\n        bind_all: function() {\n\n            log.debug('AMD Mod sharedresource metadata edition binding all events');\n\n            $('.mtd-form-input').off('change');\n            $('.taxonomy-source').off('change');\n            $('.mtd-form-addbutton').off('click');\n            $('.mtd-form-element select').off('change');\n            $('.mtd-form-element textarea').off('keyup');\n            $('.mtd-form-element input[type=\"text\"]').off('keyup');\n            $('.mtd-tab').off('click');\n            $('.mtd-tab a').off('click');\n\n            // Add check handlers to all elements.\n            $('.mtd-form-element input[type=\"text\"]').bind('keyup', this.check_empty);\n            $('.mtd-form-element select').bind('change', this.check_empty);\n            $('.mtd-form-element textarea').bind('keyup', this.check_empty);\n\n            $('.mtd-form-addbutton').bind('click', this.add_node);\n\n            // Read checkboxes may ask search widget being enabled.\n            var selector = '.' + namespace + '-system-read';\n            selector += ',.' + namespace + '-indexer-read';\n            selector += ',.' + namespace + '-author-read';\n            $(selector).off('change');\n            $(selector).bind('change', this.enable_search_widget_checkbox);\n\n            $('.taxonomy-source').bind('change', this.reload_taxonomy);\n            // Change to this form : indefinitely add binding to all now and future elements.\n            $('#id-mtd-form').on('change', '.taxonomy-source', null, this.reload_taxonomy);\n        },\n\n        trigger_all: function() {\n            log.debug('AMD Mod sharedresource metadata edition triggering changes');\n            $('.mtd-form-element input[type=\"text\"]').trigger('keyup');\n            // On selects, triggering empties preload choices on taxonomy.\n            // $('.mtd-form-element select').trigger('change');\n            $('.mtd-form-element textarea').trigger('keyup');\n        },\n\n        init: function(args) {\n\n            namespace = args;\n\n            var stringsreq = [\n                {\n                    key: 'fillprevious',\n                    component: 'sharedresource'\n                },\n                {\n                    key: 'fillcategory',\n                    component: 'sharedresource'\n                },\n            ];\n\n            str.get_strings(stringsreq).done(function(strings) {\n                mtdstrings = strings;\n            });\n\n            log.debug('AMD Mod sharedresource BIND ALL CALL');\n            metadataedit.bind_all();\n            metadataedit.bind_tabs();\n            metadataedit.trigger_all();\n\n            // check and set the initial button state.\n            $('.mtd-form-addbutton').each(metadataedit.check_button_status);\n\n            log.debug('AMD Mod sharedresource metadata edition form initialized');\n\n            $('.mtd-tab').removeClass('here');\n            $('.mtd-tab').removeClass('current');\n            $('#id-menu-1').addClass('here');\n            $('#id-menu-1').addClass('current');\n\n            $('.mtd-content').removeClass('active');\n            $('.mtd-content').removeClass('on');\n            $('.mtd-content').addClass('off');\n            $('#id-tab-1').addClass('active');\n            $('#id-tab-1').removeClass('off');\n            $('#id-tab-1').addClass('on');\n\n            log.debug('AMD Mod sharedresource metadata default switch to tab General');\n        },\n\n        check_button_status: function() {\n            var that = $(this);\n            log.debug('Check add button ' + that.attr('id'));\n            var elementname = that.attr('id').replace('id-add-', '');\n            var deps = that.attr('data');\n            var depsarr = deps.split(';');\n            var hassomeempty = false;\n            var depelm = '';\n            var dep;\n\n            dep = depsarr.shift();\n            while (dep !== undefined) {\n                depelm = $('#' + dep);\n                log.debug('   Check button dep ' + depelm.attr('id'));\n                if (depelm.parent('.mtd-form-element').hasClass('is-empty')) {\n                    hassomeempty = true;\n                    break;\n                }\n                dep = depsarr.shift();\n            }\n\n            if (hassomeempty) {\n                that.prop('disabled', true);\n            } else {\n                that.prop('disabled', false);\n            }\n\n            metadataedit.activate_up_chain(elementname);\n        },\n\n        switch_tab: function(e) {\n\n            e.stopPropagation();\n\n            // Target is a form tab link, or a form tab LI.\n            var that = $(this);\n            if (!that.attr('id')) {\n                that = that.parent();\n            }\n\n            var menuid = that.attr('id');\n\n            var regexp = /id-menu-([^-]+)$/;\n            var matches = that.attr('id').match(regexp);\n            var tabid = 'id-tab-' + matches[1];\n\n            $('.mtd-tab').removeClass('here');\n            $('.mtd-tab').removeClass('current');\n            $('#' + menuid).addClass('here');\n            $('#' + menuid).addClass('current');\n\n            $('.mtd-content').removeClass('active');\n            $('.mtd-content').removeClass('on');\n            $('.mtd-content').addClass('off');\n            $('#' + tabid).addClass('active');\n            $('#' + tabid).removeClass('off');\n            $('#' + tabid).addClass('on');\n        },\n\n        add_node: function(e) {\n\n            e.stopPropagation();\n\n            // Target is the add button.\n            var that = $(this);\n\n            // Comes in order : \"btn-$elmname-$fieldtype\"\n            /*\n             * elmname : the complete occurence id as xny_wnz (ex : 1n1_1n2, which is the JS id\n             * base for the second instance of element 1_1\n             * fieldtype : typeof field\n             */\n            var regexp = /btn-([^-]+)-([^-]+)/;\n            var matches = that.attr('name').match(regexp);\n\n            var elmid = matches[1];\n            var fieldtype = matches[2];\n            var rgx = '';\n\n            var realoccur = that.attr('data-occur');\n            log.debug(\"found real occur as \" + realoccur);\n\n            if (fieldtype != 'category') {\n                switch (fieldtype) {\n                    case 'text':\n                    case 'codetext': {\n                        if ($('#' + elmid).val() === '') {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n\n                    case 'select': {\n                        if ($('#' + elmid).val() === 'basicvalue') {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n\n                    case 'date': {\n                        if ($('#' + elmid + \"_dateyear\").val() === '- Year -') {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n\n                    case 'duration': {\n                        if (($('#' + elmid+\"_Day\").val() === '' || $('#' + elmid + \"_Day\").val() === '0') &&\n                            ($('#' + elmid + \"_Hou\").val() === '' || $('#' + elmid + \"_Hou\").val() === '0') &&\n                                ($('#' + elmid + \"_Min\").val() === '' || $('#' + elmid + \"_Min\").val() === '0') &&\n                                    ($('#' + elmid + \"_Sec\").val() === '' || $('#' + elmid+\"_Sec\").val() === '0')) {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n\n                    case 'vcard': {\n                        // eslint-disable-next-line no-control-regex\n                        rgx = new RegExp(\"(\\r\\n|\\r|\\n)\", \"g\");\n                        if ($('#' + elmid).val().replace(rgx,'').replace(/ /g, '') === 'BEGIN:VCARDVERSION:FN:N:END:VCARD') {\n                            window.alert(mtdstrings[0]);\n                            return;\n                        }\n                        break;\n                    }\n                }\n\n                metadataedit.add_list_item(elmid, realoccur);\n            } else {\n                // This is a category. We need adding a full new branch.\n                //  Check we really need to add an item (something filled in the subs  ?)\n                var listchildren = that.attr('data');\n                var listtab = listchildren.split(' ');\n                var nbremptyfield = 0;\n                var childid;\n\n                for (var i = 0; i < listtab.length; i++) {\n\n                    childid = listtab[i];\n\n                    if ($('#' + childid).val() === '') {\n                        nbremptyfield++;\n                    }\n                    if ($('#' + childid).val() === 'basicvalue') {\n                        nbremptyfield++;\n                    }\n                    if ($('#' + childid + \"_dateyear\").val() === '-year-') {\n                        nbremptyfield++;\n                    }\n                    if (($('#' + childid + \"_Day\").val() === '' || $('#' + childid + \"_Day\").val() === '0') &&\n                        ($('#' + childid + \"_Hou\").val() === '' || $('#' + childid + \"_Hou\").val() === '0') &&\n                            ($('#' + childid + \"_Min\").val() === '' || $('#' + childid + \"_Min\").val() === '0') &&\n                                ($('#' + childid + \"_Sec\").val() === '' || $('#' + childid + \"_Sec\").val() === '0') ) {\n                        nbremptyfield++;\n                    }\n                    if ($('#' + childid).val() === 'undefined') {\n                        // eslint-disable-next-line no-control-regex\n                        rgx = new RegExp(\"(\\r\\n|\\r|\\n)\", \"g\" );\n                        if ($('#' + childid).val().replace(rgx, '').replace(/ /g, '') === 'BEGIN:VCARDVERSION:FN:N:END:VCARD') {\n                            nbremptyfield++;\n                        }\n                    }\n                }\n\n                if (nbremptyfield == listtab.length) {\n                    window.alert(mtdstrings[1]);\n                } else {\n                    // Our current taxonsource can be found by following the route :\n                    // 1. button clicked has last taxon in 'data'.\n                    // 2. last taxon select has its source select ref in 'source'\n                    // 3. source select has current value of taxon source\n                    var sourcetaxons = that.attr('data').split(' ');\n                    var basetaxon = sourcetaxons.pop();\n                    log.debug(\"Get source taxon in #\" + metadata.parent_name(basetaxon) + '_1n0');\n                    var sourceselect = $('#' + metadata.parent_name(basetaxon) + '_1n0');\n                    var taxonsourceid = sourceselect.val();\n                    log.debug(\"Resulting taxonresourceid  = \" + taxonsourceid);\n\n                    metadataedit.add_list_item(elmid, realoccur, taxonsourceid);\n                }\n            }\n        },\n\n        /**\n         * Calls an ajax renderer to produce a new form subtree fragment.\n         * keyid : the current element instanceid (m_n_o:x_y_z)\n         * numoccur : the occurrence number of the node (int)\n         * realoccur :\n         */\n        add_list_item: function(elmname, realoccur, taxonsourceid) {\n\n            var oldid = 'id-add-' + elmname;\n            var olddata = $('#' + oldid).attr('data');\n\n            var newname = metadata.next_occurrence_name(elmname);\n            realoccur++;\n            log.debug(\"Next real occur is \" + realoccur);\n\n            // Get form fragment for next occurrence.\n            var params = \"elementname=\" + newname;\n            if (taxonsourceid) {\n                params += \"&taxonsourceid=\" + taxonsourceid;\n            }\n            params += \"&realoccur=\" + realoccur;\n            var url = cfg.wwwroot + \"/mod/sharedresource/ajax/getformelement.php?\" + params;\n\n            $.get(url, function(data) {\n                var zonename = \"#add-zone-\" + elmname;\n                $(data.html).insertBefore(zonename);\n\n                // Recode the add button id for next play, incrementing occurence index.\n                oldid = CSS.escape(oldid);\n\n                var newid = 'id-add-' + newname;\n                newid = CSS.escape(newid);\n\n                // We get the new incremented occurrence name from AJAX return.\n                $('#' + oldid).attr('name', 'btn-' + data.name);\n                // Change the button id so next press launches query for next occurence.\n                $('#' + oldid).attr('id', newid);\n                $('#' + newid).prop('disabled', true);\n                $('#' + newid).attr('data-occur', realoccur);\n                log.debug(\"Shifting button \" + newid + \" real occur as \" + realoccur);\n                // Shift add zone name to match new button.\n                $('#add-zone-' + elmname).attr('id', 'add-zone-' + newname);\n                $('#' + newid).attr('data', olddata);\n\n                // Rebind all change handlers, including on new elements.\n                metadataedit.bind_all();\n                metadataedit.bind_tabs();\n\n            }, 'json');\n        },\n\n        activate_up_chain: function(elementname) {\n\n            // Unlock upper buttons in chain.\n            var parentname = elementname;\n            log.debug(\"Processing to elementkey \" + elementname);\n            parentname = metadata.parent_name(parentname);\n            while (parentname) {\n                log.debug(\"Escalading to parentkey \" + parentname);\n                log.debug(\"Detected \" + $('#id-add-' + parentname).attr('name'));\n                log.debug(\"Detected \" + $('#id-add-' + parentname).prop('disabled'));\n                $('#id-add-' + CSS.escape(parentname)).prop('disabled', false);\n                parentname = metadata.parent_name(parentname);\n            }\n        },\n\n        reload_taxonomy: function(e) {\n\n            e.stopPropagation();\n\n            var that = $(this);\n\n            // Fetch new taxonomy.\n            var url = cfg.wwwroot + '/mod/sharedresource/ajax/gettaxonomymenu.php?id=' + that.val();\n            $.get(url, function(data){\n\n                var parentid = metadata.parent_name(that.attr('id'));\n\n                // Clear out all values and change option list.\n                $('[data-source=\"' + parentid + '\"]').each(function() {\n                    $(this).html(data);\n                    $(this).val('');\n                });\n\n            }, 'html');\n\n        },\n\n        check_empty: function() {\n            var that = $(this);\n            log.debug(\"Check \" + that.attr('id'));\n            var branchid = that.attr('id').substring(0, 1);\n\n            if (that.val()) {\n                // mark element as fullfilled.\n                that.parent('.mtd-form-element').removeClass('is-empty');\n\n                // mark same branch tab as fullfilled.\n                var otheremptyonbranch = $('.mtd-form-element.is-mandatory-' + branchid + '.is-empty');\n                if (!otheremptyonbranch || (otheremptyonbranch.length === 0)) {\n                    $('#id-menu-' + branchid).removeClass('is-empty');\n                }\n\n                // unlock form submit if no more empty on whole form.\n                var otherempty = $('.mtd-form-element.is-mandatory.is-empty');\n                if (!otherempty || (otherempty.length === 0)) {\n                    $('#id-mtd-submit').attr('disabled', false);\n                    $('#id-mtd-submit').removeClass('is-disabled');\n                }\n\n            } else {\n                // mark element as empty.\n                that.parent('.mtd-form-element').addClass('is-empty');\n\n                if (that.hasClass('is-mandatory')) {\n                    // lock form submit.\n                    $('#id-mtd-submit').attr('disabled', true);\n                    $('#id-mtd-submit').addClass('is-disabled');\n\n                    // mark same branch tab as empty.\n                    $('#id-menu-' + branchid).addClass('is-empty');\n                }\n            }\n\n            // Whatever the result, search the potentially affected buttons and update them.\n            var affectedaddbtns = $('input[name^=\"btn-' + that.attr('id') + '-\"]');\n            affectedaddbtns.each(metadataedit.check_button_status);\n        }\n    };\n\n    return metadataedit;\n});"],"file":"metadataedit.min.js"}